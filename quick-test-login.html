<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quick Test Login Flow</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #f5f5f5;
    }
    .result {
      background: white;
      padding: 20px;
      margin: 10px 0;
      border-radius: 5px;
      border-left: 4px solid #667eea;
    }
    button {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #5568d3;
    }
    .success { border-left-color: #52c41a; }
    .error { border-left-color: #ff4d4f; }
    pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>üîç Quick Test Login Flow - 0344406126</h1>
  <button onclick="testLoginFlow()">‚ñ∂Ô∏è Test Login Flow</button>
  <div id="output"></div>

  <script>
    const API_BASE = 'https://bi.meraplion.com/local';
    const PHONE = '0344406126';
    
    async function testLoginFlow() {
      const output = document.getElementById('output');
      output.innerHTML = '<div class="result">‚è≥ Testing...</div>';
      
      try {
        // STEP 1: Login API
        console.log('üìû Calling login API...');
        const loginRes = await fetch(`${API_BASE}/get_data/get_nvbc_login/?test=1&phone=${PHONE}`);
        const loginData = await loginRes.json();
        
        console.log('‚úÖ Login Response:', loginData);
        
        // STEP 2: Reward API
        console.log('üéÅ Calling reward API...');
        const rewardRes = await fetch(`${API_BASE}/nvbc_get_point/?phone=${PHONE}`);
        const rewardData = await rewardRes.json();
        
        console.log('‚úÖ Reward Response:', rewardData);
        
        // Merge logic
        const isValidInvitee = loginData.is_valid_invitee !== undefined 
          ? loginData.is_valid_invitee 
          : (rewardData.is_valid_invitee || false);
        
        const point = rewardData.point || 0;
        const shouldShowPopup = isValidInvitee === true && point === 0;
        
        // Display result
        let html = `
          <div class="result success">
            <h3>‚úÖ API Responses:</h3>
            
            <h4>üìû Login API Response:</h4>
            <pre>${JSON.stringify(loginData, null, 2)}</pre>
            
            <h4>üéÅ Reward API Response:</h4>
            <pre>${JSON.stringify(rewardData, null, 2)}</pre>
          </div>
          
          <div class="result">
            <h3>üîç Logic Check:</h3>
            <p><strong>is_valid_invitee (from login):</strong> ${loginData.is_valid_invitee}</p>
            <p><strong>is_valid_invitee (from reward):</strong> ${rewardData.is_valid_invitee}</p>
            <p><strong>is_valid_invitee (merged):</strong> ${isValidInvitee}</p>
            <p><strong>point:</strong> ${point}</p>
          </div>
          
          <div class="result ${shouldShowPopup ? 'success' : 'error'}">
            <h2>${shouldShowPopup ? '‚úÖ HI·ªÜN POPUP' : '‚ùå KH√îNG HI·ªÜN POPUP'}</h2>
            <p><strong>Condition:</strong> is_valid_invitee === true && point === 0</p>
            <p><strong>Result:</strong> ${isValidInvitee} === true && ${point} === 0 = ${shouldShowPopup}</p>
          </div>
        `;
        
        output.innerHTML = html;
        
      } catch (error) {
        output.innerHTML = `<div class="result error">‚ùå Error: ${error.message}</div>`;
        console.error('Error:', error);
      }
    }
    
    // Auto run
    window.addEventListener('load', () => {
      console.log('üöÄ Ready to test. Click button or call testLoginFlow()');
    });
  </script>
</body>
</html>
